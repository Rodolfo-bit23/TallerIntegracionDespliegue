      - run:
          name: Verificar variables requeridas
          command: |
            for v in RAILWAY_TOKEN RAILWAY_PROJECT_ID RAILWAY_SERVICE_ID; do
              if [ -z "${!v:-}" ]; then
                echo "ERROR: Falta variable $v en CircleCI > Project Settings > Environment Variables"
                exit 1
              fi
            done
            echo "Variables presentes (token len=${#RAILWAY_TOKEN})"

      - run:
          name: Login no interactivo a Railway (con token)
          command: |
            # Algunas versiones usan 'login', otras 'auth login': probamos ambas.
            npx -y @railway/cli@latest login --token "$RAILWAY_TOKEN" \
              || npx -y @railway/cli@latest auth login --token "$RAILWAY_TOKEN"

      - run:
          name: Link no-interactivo (proyecto y servicio)
          command: |
            npx -y @railway/cli@latest link \
              --project "$RAILWAY_PROJECT_ID" \
              --service "$RAILWAY_SERVICE_ID" \
              --token "$RAILWAY_TOKEN"

      - run:
          name: Desplegar a Railway
          command: |
            npx -y @railway/cli@latest up --ci --token "$RAILWAY_TOKEN"



