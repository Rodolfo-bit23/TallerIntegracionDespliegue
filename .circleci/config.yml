version: 2.1

jobs:
  deploy:
    docker:
      - image: cimg/node:20.9    # LTS actual, consistente con el taller
    environment:
      RAILWAY_LOG_FORMAT: pretty
    steps:
      - checkout

      - run:
          name: Verificar variable de entorno (RAILWAY_TOKEN)
          command: |
            if [ -z "$RAILWAY_TOKEN" ]; then
              echo "ERROR: falta RAILWAY_TOKEN en Project Settings > Environment Variables"
              exit 1
            fi
            echo "RAILWAY_TOKEN detectado correctamente"

      - run:
          name: Desplegar a Railway con npx (sin instalaci√≥n global)
          command: |
            # Sustituye el nombre del servicio por el tuyo exacto en Railway
            npx -y @railway/cli@latest up --service="amiable-perfection" --ci
            # Si prefieres por ID de servicio:  npx -y @railway/cli@latest up --service-id="$RAILWAY_SERVICE_ID" --ci

workflows:
  version: 2
  deploy_workflow:
    jobs:
      - deploy